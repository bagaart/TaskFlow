<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow - Главная</title>
    <link rel="stylesheet" href="../static/styles/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <a class="logo" href="{{ url_for('taskflow.index') }}"><span>TaskFlow</span></a>
    </header>

    <aside class="sidebar">
        <ul class="nav-menu">
            <li><a href="#"><img class="icon" src="https://img.icons8.com/windows/32/search--v1.png" alt="search--v1"/>Поиск</a></li>
            <li><a href="{{ url_for('taskflow.tasks') }}"><img class="icon" src="https://img.icons8.com/windows/32/todo-list.png" alt="todo-list"/>Задачи</a></li>
            <li><a href="{{ url_for('taskflow.projects') }}"><img class="icon" src="https://img.icons8.com/windows/32/flipboard.png" alt="flipboard"/>Проекты</a></li>
            <li><a href="#"><img class="icon" src="https://img.icons8.com/windows/32/gender-neutral-user.png" alt="gender-neutral-user"/>Профиль</a></li>

            <li><a href="{{ url_for('taskflow.create_task') }}" class="create-task"><img class="icon" src="https://img.icons8.com/windows/32/plus-math.png" alt="plus-math"/>Создать задачу</a></li>

            <li><a href="{{ url_for('taskflow.create_project') }}" class="create-task"><img class="icon" src="https://img.icons8.com/windows/32/plus-math.png" alt="plus-math"/>Создать проект</a></li>
        </ul>

        <ul class="nav-menu bottom-menu">
            <li><a href="#"><img class="icon" src="https://img.icons8.com/windows/32/help.png" alt="help"/>Помощь</a></li>
            <li><a href="#"><img class="icon" src="https://img.icons8.com/windows/32/settings--v1.png" alt="settings--v1"/>Настройки</a></li>
            <li><a href="{{ url_for('taskflow.logout') }}"><img class="icon" src="https://img.icons8.com/windows/32/exit.png" alt="exit"/>Выход</a></li>
        </ul>
    </aside>

    <main class="main-content">
        <div class="dashboard-header">
            <h1>Моя панель</h1>
            <div class="view-switcher">
                <button class="view-btn active" data-view="tasks">
                    <i class="fas fa-tasks"></i> Мои задачи
                </button>
                <button class="view-btn" data-view="projects">
                    <i class="fas fa-project-diagram"></i> Мои проекты
                </button>
            </div>
        </div>

        <div class="dashboard-section" id="tasks-section">
            <div class="section-header">
                <h2>Мои задачи</h2>
                <a href="{{ url_for('taskflow.tasks') }}" class="see-all">
                    Все задачи <i class="fas fa-chevron-right"></i>
                </a>
            </div>

            <div class="task-categories">
                <div class="category">
                    <h3><i class="fas fa-user-tie"></i> Я автор</h3>
                    {% if manager_tasks %}
                        {% for task in manager_tasks[:3] %}
                        <div class="task-item">
                            <div class="task-title">{{ task.title }}</div>
                            <div class="task-meta">
                                <span class="task-status {{ task.status.lower().replace(' ', '-') }}">
                                    {{ task.status }}
                                </span>
                                <span class="task-project">{{ task.project.name }}</span>
                            </div>
                        </div>
                        {% endfor %}
                        {% if manager_tasks|length > 3 %}
                        <div class="more-tasks">+{{ manager_tasks|length - 3 }} ещё</div>
                        {% endif %}
                    {% else %}
                        <p class="empty-tasks">Нет задач, где вы автор</p>
                    {% endif %}
                </div>

                <div class="category">
                    <h3><i class="fas fa-user-check"></i> Я исполнитель</h3>
                    {% if executor_tasks %}
                        {% for task in executor_tasks[:3] %}
                        <div class="task-item">
                            <div class="task-title">{{ task.title }}</div>
                            <div class="task-meta">
                                <span class="task-status {{ task.status.lower().replace(' ', '-') }}">
                                    {{ task.status }}
                                </span>
                                <span class="task-project">{{ task.project.name }}</span>
                            </div>
                        </div>
                        {% endfor %}
                        {% if executor_tasks|length > 3 %}
                        <div class="more-tasks">+{{ executor_tasks|length - 3 }} ещё</div>
                        {% endif %}
                    {% else %}
                        <p class="empty-tasks">Нет задач, где вы исполнитель</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="dashboard-section hidden" id="projects-section">
            <div class="section-header">
                <h2>Мои проекты</h2>
                <a href="{{ url_for('taskflow.projects') }}" class="see-all">
                    Все проекты <i class="fas fa-chevron-right"></i>
                </a>
            </div>

            <div class="projects-grid">
                {% for project in user_projects[:6] %}
                <div class="project-card">
                    <h3>{{ project.name }}</h3>
                    <p class="project-description">
                        {{ project.description|truncate(100) if project.description else "Нет описания" }}
                    </p>
                    <div class="project-meta">
                        <span class="tasks-count">
                            <i class="fas fa-tasks"></i> {{ project.tasks|length }} задач
                        </span>
                        {% if project.deadline %}
                        <span class="project-deadline">
                            <i class="fas fa-calendar-alt"></i> {{ project.deadline.strftime('%d.%m.%Y') }}
                        </span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
                {% if user_projects|length > 6 %}
                <div class="project-card more-projects">
                    <h3>+{{ user_projects|length - 6 }} проектов</h3>
                    <p>Показать все проекты</p>
                </div>
                {% endif %}
            </div>
        </div>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Переключение между задачами и проектами
        const viewBtns = document.querySelectorAll('.view-btn');
        const tasksSection = document.getElementById('tasks-section');
        const projectsSection = document.getElementById('projects-section');

        viewBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // Удаляем активный класс у всех кнопок
                viewBtns.forEach(b => b.classList.remove('active'));
                // Добавляем активный класс текущей кнопке
                this.classList.add('active');

                // Показываем/скрываем соответствующие секции
                if (this.dataset.view === 'tasks') {
                    tasksSection.classList.remove('hidden');
                    projectsSection.classList.add('hidden');
                } else {
                    tasksSection.classList.add('hidden');
                    projectsSection.classList.remove('hidden');
                }
            });
        });

        // Клик по карточке проекта
        document.querySelectorAll('.project-card').forEach(card => {
            card.addEventListener('click', function() {
                const projectId = this.dataset.projectId;
                if (projectId) {
                    window.location.href = `/board/${projectId}`;
                } else if (this.classList.contains('more-projects')) {
                    window.location.href = "{{ url_for('taskflow.projects') }}";
                }
            });
        });
    });
    </script>
</body>
</html>